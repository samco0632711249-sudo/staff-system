<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Staff Master System V29 (Auto-Cutoff)</title>
    <style>
        :root { --primary: #1e3a8a; --accent: #22c55e; --red: #ef4444; --gray: #94a3b8; }
        body { font-family: 'Kanit', sans-serif; background: linear-gradient(135deg, #3b82f6 0%, #2dd4bf 100%); background-attachment: fixed; margin: 0; padding: 10px; display: flex; justify-content: center; }
        .container { max-width: 500px; width: 100%; background: #fff; padding: 15px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; }
        
        h2 { color: var(--primary); text-align: center; font-size: 18px; margin: 5px 0 10px 0; }
        .btn-settings { position: absolute; right: 15px; top: 15px; background: #f1f5f9; padding: 8px; border-radius: 10px; cursor: pointer; border: 1px solid #e2e8f0; font-size: 16px; z-index: 100; }
        .date-display { text-align: center; color: #1e3a8a; font-weight: 600; margin-bottom: 12px; background: #e0f2fe; padding: 10px; border-radius: 12px; font-size: 15px; border: 1px solid #7dd3fc; }
        
        .section { background: #f0fdf4; border-left: 4px solid var(--accent); border-radius: 12px; padding: 10px; margin-bottom: 10px; }
        .ot-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 6px; }
        .ot-card { background: white; padding: 6px; border-radius: 10px; border: 1px solid #e2e8f0; display: flex; flex-direction: column; align-items: center; gap: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .ot-name { font-size: 12px; font-weight: 600; color: #334155; text-align: center; width: 100%; overflow: hidden; }
        .ot-controls { display: flex; align-items: center; gap: 6px; }
        .btn-ot { width: 20px; height: 20px; border-radius: 5px; border: none; color: white; font-weight: bold; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; }
        .btn-minus { background: var(--gray); }
        .btn-plus { background: var(--accent); }
        .ot-val-display { font-size: 13px; font-weight: bold; color: var(--primary); min-width: 18px; text-align: center; }

        .staff-row { display: grid; grid-template-columns: 115px 1fr 1fr; gap: 5px; padding: 8px 0; border-bottom: 1px solid #f1f5f9; align-items: center; }
        .name-area { display: flex; align-items: center; gap: 6px; }
        .btn-h { background: #f1f5f9; color: #94a3b8; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 11px; padding: 4px 8px; cursor: pointer; font-weight: bold; }
        .btn-h.active { background: #ef4444; color: white; border-color: #b91c1c; }
        .staff-name { font-weight: 500; font-size: 13px; color: #334155; }
        
        .point-input, select, .locked, .set-input { width: 100%; padding: 7px; border-radius: 8px; border: 1px solid #cbd5e1; font-family: 'Kanit'; font-size: 11px; outline: none; background: white; box-sizing: border-box; }
        .locked { text-align: center; font-weight: bold; font-size: 11px; }
        .locked.is-holiday { background: #fff1f2; color: #e11d48; border-color: #fda4af; }
        
        .btn-copy { width: 100%; padding: 15px; background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%); color: white; border: none; border-radius: 15px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 15px; }

        #settingsView { display: none; }
        .settings-card { background: #f8fafc; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .btn-danger { background: var(--red); color: white; border: none; border-radius: 8px; padding: 10px; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>

<div class="container">
    <div id="mainView">
        <div class="btn-settings" onclick="toggleSettings()">‚öôÔ∏è</div>
        <h2>‚ú® ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‚ú®</h2>
        <div id="dateDisplay" class="date-display"></div>
        <div id="cutoffInfo" style="text-align:center; font-size:10px; color:#64748b; margin-top:-8px; margin-bottom:10px;">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πâ‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16</div>

        <div class="section">
            <div style="font-weight: 600; color: #166534; font-size: 12px; margin-bottom:8px;">üè† ‡∏Ñ‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ (‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πâ‡∏° OT):</div>
            <div id="otContainer" class="ot-group"></div>
        </div>

        <div id="staffList"></div>
        <button class="btn-copy" onclick="copyResult()">üöÄ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡πà‡∏á LINE üöÄ</button>
    </div>

    <div id="settingsView">
        <h2 style="font-size:16px;">üõ†Ô∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h2>
        <div class="settings-card">
            <div style="font-weight:bold; color:var(--red); font-size:14px; margin-bottom:5px;">‚ö†Ô∏è ‡πÇ‡∏ã‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢</div>
            <div style="font-size:12px; color:#64748b;">‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πâ‡∏° OT ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏õ‡∏Å‡∏ï‡∏¥‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16)</div>
            <button class="btn-danger" onclick="manualResetOT()">‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πâ‡∏° OT ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0</button>
        </div>
        <button class="btn-copy" style="background:#64748b;" onclick="toggleSettings()">üíæ ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
</div>

<script>
// --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å V28) ---
let mainStaff = JSON.parse(localStorage.getItem('mainStaff_V29')) || ["‡∏ö‡∏∏‡∏ç‡∏ï‡∏≤", "‡∏ö‡∏¥‡∏ß", "‡∏ô‡∏≤‡∏ß‡∏¥‡∏ô", "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤", "‡∏ß‡∏±‡∏î", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏û‡∏•", "‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥", "‡πÇ‡∏ã‡πà‡∏™‡∏∏", "‡∏≠‡∏∏‡πÑ‡∏£"];
let holidayDB = JSON.parse(localStorage.getItem('holidayDB_V29')) || {
    0: ["‡∏™‡∏°‡∏±‡∏¢", "‡∏™‡∏∏‡∏ô‡∏ó‡∏£‡∏µ", "‡∏ä‡∏±‡∏ä‡∏ä‡∏±‡∏¢", "‡∏Ç‡∏±‡∏ô‡∏ò‡∏∞‡∏•‡∏µ", "‡∏à‡∏¥‡∏£‡∏™‡∏∏‡∏î‡∏≤", "‡∏≠‡∏¥‡πà‡∏°‡∏ï‡∏µ‡πâ", "‡∏ï‡∏¥‡∏°", "‡∏£‡∏≤‡∏ì‡∏µ", "‡∏Å‡∏±‡∏ç‡∏ç‡∏≤‡∏†‡∏±‡∏ó‡∏£", "‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥"],
    1: ["‡∏ä‡∏•‡∏ò‡∏¥‡∏ä‡∏≤", "‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏†‡∏≤", "‡πÄ‡∏à‡∏≤‡∏∞", "‡∏•‡∏≥‡∏û‡∏π‡∏ô", "‡∏™‡∏∏‡∏ß‡∏±‡∏ô‡∏ô‡∏≤", "‡∏ä‡∏ô‡∏±‡∏ç‡∏ä‡∏¥‡∏ï‡∏≤", "‡∏≠‡∏ô‡∏∏‡∏ß‡∏±‡∏í‡∏ô‡πå", "‡∏ô‡πâ‡∏≠‡∏á‡∏•‡∏±‡∏î"],
    2: ["‡∏õ‡∏≤‡∏ì‡∏¥‡∏®‡∏£‡∏≤", "‡∏à‡∏±‡∏ô‡∏ó‡∏ô‡∏≤", "‡∏™‡∏∏‡∏Å‡∏±‡∏ç‡∏ç‡∏≤", "‡πÄ‡∏û‡∏µ‡∏¢‡∏ö", "‡∏ß‡∏∏‡∏í‡∏¥", "‡∏õ‡∏£‡∏¥‡∏¢‡∏ô‡∏∏‡∏ä", "‡∏≠‡∏≤‡∏ó", "‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏≤", "‡∏´‡∏ô‡∏π‡∏ô‡∏¥‡∏î", "‡∏à‡∏¥‡∏î‡∏≤‡∏†‡∏≤", "‡∏à‡∏¥‡∏ï‡∏£‡∏û‡∏á‡∏©‡πå"],
    3: ["‡πÅ‡∏û‡∏á‡∏®‡∏£‡∏µ", "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏≤", "‡∏û‡∏•", "‡∏ó‡∏≠‡∏á‡∏™‡∏π‡∏ô", "‡∏õ‡∏£‡∏∞‡πÑ‡∏û", "‡∏õ‡∏£‡∏∞‡∏û‡∏±‡∏ô‡∏ò‡πå‡πÅ‡∏™‡∏á", "‡∏ò‡∏ß‡∏±‡∏ä", "‡∏õ‡∏£‡∏≤‡πÇ‡∏°‡∏ó‡∏¢‡πå", "‡∏™‡∏∏‡∏ä‡∏≤‡∏î‡∏≤", "‡∏≠‡∏ô‡∏á‡∏Ñ‡πå", "‡∏ß‡∏£‡∏£‡∏ï‡∏≤‡∏†‡∏≤", "‡∏û‡∏¥‡∏°‡∏ß‡∏î‡∏µ"],
    4: ["‡πÅ‡∏≠‡πä‡∏∞‡πÅ‡∏≠‡πä‡∏∞", "‡∏ì‡∏¥‡∏ä‡∏≤‡∏î‡∏≤", "‡∏™‡∏°‡∏™‡∏≤‡∏¢", "‡∏™‡∏µ‡∏ô‡∏ß‡∏•", "‡∏î‡∏≤‡∏î‡πâ‡∏≤", "‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢", "‡∏•‡∏±‡∏î‡∏î‡∏≤‡∏ß‡∏±‡∏•‡∏¢‡πå", "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", "‡∏ö‡∏¥‡∏ß", "‡∏ô‡∏≤‡∏ß‡∏¥‡∏ô"],
    5: ["‡∏Å‡∏£‡∏£‡∏ì‡∏¥‡∏Å‡∏≤", "‡∏ô‡πâ‡∏≥‡∏≠‡πâ‡∏≠‡∏¢", "‡∏ô‡∏¥‡∏î", "‡∏ã‡∏π‡∏•‡∏Å‡∏¥‡∏ü‡∏•‡∏µ", "‡∏ú‡πà‡∏≠‡∏á‡∏®‡∏£‡∏µ", "‡πÅ‡∏™‡∏á", "‡πÅ‡∏ï‡∏á‡πÇ‡∏°", "‡∏ö‡∏∏‡∏ç‡∏ï‡∏≤", "‡∏û‡∏•‡∏≤‡∏Å‡∏£", "‡∏•‡∏≠‡∏¢"],
    6: ["‡∏ß‡∏±‡∏î", "‡∏™‡∏≤‡∏¢‡πÉ‡∏à", "‡πÄ‡∏Ç‡∏°‡∏¥‡∏Å‡∏≤", "‡∏¢‡∏∏‡∏ß‡∏î‡∏µ", "‡∏ô‡∏¥‡∏ï‡∏¢‡∏≤", "‡∏õ‡∏∏‡πâ‡∏°", "‡∏ô‡∏¥‡∏î‡∏≤", "‡∏•‡∏≥‡∏î‡∏ß‡∏ô", "‡πÇ‡∏ã‡πà‡∏™‡∏∏", "‡∏≠‡∏∏‡πÑ‡∏£"]
};
let otHistory = JSON.parse(localStorage.getItem('ot_v29_data')) || {};
let lastResetMonth = localStorage.getItem('last_reset_month_v29') || "";

// --- ‡∏£‡∏∞‡∏ö‡∏ö Auto Reset ---
function checkAutoReset() {
    const now = new Date();
    const currentMonth = now.getMonth() + "-" + now.getFullYear();
    const currentDate = now.getDate();

    // ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
    if (currentDate >= 16 && lastResetMonth !== currentMonth) {
        otHistory = {}; // ‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πâ‡∏°
        localStorage.setItem('ot_v29_data', JSON.stringify(otHistory));
        localStorage.setItem('last_reset_month_v29', currentMonth);
        console.log("‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏±‡∏î‡∏ß‡∏µ‡∏Ñ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    }
}

function manualResetOT() {
    if(confirm("‡∏°‡∏∂‡∏á‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ô‡∏∞‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0? ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏∞!")) {
        otHistory = {};
        localStorage.setItem('ot_v29_data', JSON.stringify(otHistory));
        alert("‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏∂‡∏á!");
        renderMain();
    }
}

function updateOT(name, val) {
    otHistory[name] = Math.max(0, (otHistory[name] || 0) + val);
    localStorage.setItem('ot_v29_data', JSON.stringify(otHistory));
    renderMain();
}

function toggleSettings() {
    const main = document.getElementById('mainView');
    const set = document.getElementById('settingsView');
    if(main.style.display === 'none') { main.style.display = 'block'; set.style.display = 'none'; renderMain(); } 
    else { main.style.display = 'none'; set.style.display = 'block'; }
}

function renderMain() {
    checkAutoReset(); // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏ß‡∏µ‡∏Ñ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
    const target = new Date(); target.setDate(target.getDate() + 1);
    const day = target.getDay();
    const dateStr = target.toLocaleDateString('th-TH', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
    document.getElementById('dateDisplay').innerText = dateStr;

    const tomorrowHolidays = holidayDB[day] || [];
    let otHtml = '';
    tomorrowHolidays.forEach(n => {
        let count = otHistory[n] || 0;
        otHtml += `
            <div class="ot-card">
                <span class="ot-name">${n}</span>
                <div class="ot-controls">
                    <button class="btn-ot btn-minus" onclick="updateOT('${n}', -1)">-</button>
                    <span class="ot-val-display">${count}</span>
                    <button class="btn-ot btn-plus" onclick="updateOT('${n}', 1)">+</button>
                </div>
            </div>`;
    });
    document.getElementById('otContainer').innerHTML = otHtml || '<div style="font-size:11px; color:gray;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏û‡∏¢‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</div>';

    let html = '';
    mainStaff.forEach(name => {
        let pt = (name === "‡∏û‡∏•") ? "3K ‡∏ö‡πà‡∏≠‡∏Ç‡∏¢‡∏∞" : (name === "‡∏ß‡∏±‡∏î") ? "2K ‡∏ö‡πà‡∏≠‡∏Ç‡∏¢‡∏∞" : "‡∏ß‡πà‡∏≤‡∏á";
        html += `<div class="staff-row">
            <div class="name-area">
                <div class="btn-h" onclick="alert('‡∏õ‡∏∏‡πà‡∏° H ‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥')">H</div>
                <div class="staff-name">üë§ ${name}</div>
            </div>
            <div><input type="text" class="point-input" value="${pt}"></div>
            <div><select class="tm-sel"><option>07:00 - 19:00 ‚è∞</option></select></div>
        </div>`;
    });
    document.getElementById('staffList').innerHTML = html;
}

function copyResult() {
    alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß! (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô V28)");
}

renderMain();
</script>
</body>
</html>
